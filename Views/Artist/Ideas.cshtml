@{
    ViewData["Title"] = "AI Inspiration";
    Layout = "_ArtistLayout";
}

<div class="max-w-4xl mx-auto px-4 py-8">
    <div class="text-center mb-16">
        <h1 class="font-display text-5xl md:text-6xl text-white mb-6 tracking-wide drop-shadow-[0_0_15px_rgba(255,255,255,0.1)]">
            The <span class="text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500">Digital Muse</span>
        </h1>
        <p class="font-serif text-xl text-white/60 italic max-w-2xl mx-auto">
            "When the well of creativity runs dry, let the machine dream for you."
        </p>
    </div>

    <!-- Generator Interface -->
    <div class="bg-black/30 backdrop-blur-xl border border-white/10 p-8 md:p-12 relative overflow-hidden rounded-md group">
        <!-- Shine effect -->
        <div class="absolute inset-0 bg-gradient-to-tr from-purple-500/10 via-transparent to-pink-500/10 pointer-events-none"></div>

        <div class="relative z-10 flex flex-col items-center">
            
            <!-- Result Container -->
            <div id="muse-result" class="w-full aspect-square md:aspect-[16/9] mb-8 bg-black/50 border border-white/5 flex flex-col items-center justify-center relative overflow-hidden hidden transition-all duration-1000 shadow-2xl">
                <img id="generated-image" src="" class="w-full h-full object-cover opacity-0 transition-opacity duration-1000" />
                <div id="muse-loading" class="absolute inset-0 bg-black flex flex-col items-center justify-center hidden z-20">
                    <div class="w-16 h-16 border-4 border-t-purple-500 border-r-pink-500 border-b-indigo-500 border-l-transparent rounded-full animate-spin mb-4"></div>
                    <p class="font-display text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400 tracking-widest animate-pulse">DREAMING...</p>
                </div>
            </div>

            <!-- Prompt Display (Below Image) -->
            <div id="prompt-container" class="w-full mb-12 hidden opacity-0 transition-all duration-1000 transform translate-y-4">
                <div class="bg-white/5 border-l-2 border-purple-500 p-6 rounded-r-lg backdrop-blur-sm">
                    <p class="font-display text-xs text-purple-400 uppercase tracking-widest mb-3 flex items-center gap-2">
                        <i class="bi bi-chat-quote"></i> The Muse Whispers:
                    </p>
                    <p id="generated-prompt" class="font-serif text-lg text-white/90 italic leading-relaxed"></p>
                </div>
            </div>

            <!-- Placeholder State -->
            <div id="muse-placeholder" class="text-center py-20 opacity-50">
                <i class="bi bi-stars text-6xl mb-4 block text-purple-500/50"></i>
                <p class="font-serif text-white/50">Click below to summon inspiration</p>
            </div>

            <!-- Controls -->
            <div class="flex flex-col items-center gap-6 w-full max-w-md">
                <button onclick="generateIdea()" id="btn-generate" class="relative overflow-hidden group w-full py-5 bg-white/5 border border-white/10 hover:border-purple-500/50 transition-all duration-300">
                    <div class="absolute inset-0 bg-gradient-to-r from-purple-600 to-pink-600 opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                    <span class="relative font-display text-xl tracking-[0.2em] text-white flex items-center justify-center gap-3">
                        <i class="bi bi-shufffle"></i> IGNITE IDEA
                    </span>
                </button>
                
                <p class="text-[10px] text-white/30 uppercase tracking-widest font-sans">
                    Powered by Pollinations API â€¢ Infinite Possibilities
                </p>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        async function generateIdea() {
            const btn = document.getElementById('btn-generate');
            const placeholder = document.getElementById('muse-placeholder');
            const resultBox = document.getElementById('muse-result');
            const img = document.getElementById('generated-image');
            const loader = document.getElementById('muse-loading');
            const promptText = document.getElementById('generated-prompt');
            const promptContainer = document.getElementById('prompt-container'); // Get new container

            // UI State: Loading
            placeholder.style.display = 'none';
            resultBox.classList.remove('hidden');
            resultBox.classList.add('flex');
            loader.classList.remove('hidden');
            loader.classList.add('flex');
            img.style.opacity = '0';
            
            // Hide previous result properly
            promptContainer.classList.add('hidden');
            promptContainer.classList.remove('opacity-100', 'translate-y-0');
            promptContainer.classList.add('opacity-0', 'translate-y-4');
            
            btn.disabled = true;
            btn.querySelector('span').innerHTML = '<i class="bi bi-hourglass-split animate-spin"></i> CONJURING...';

            // 1. Request Random Prompt & Generation from Backend
            try {
                // Call Backend API with "GENERATE_RANDOM" flag
                const response = await fetch('/Artist/GenerateIdea', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: "GENERATE_RANDOM" })
                });

                const result = await response.json();

                if (result.success) {
                    // 3. Load Image & Show Generated Prompt
                    img.src = result.imageUrl;
                    promptText.textContent = `"${result.prompt}"`;
                    
                    img.onload = function() {
                        loader.classList.add('hidden');
                        loader.classList.remove('flex');
                        
                        // Reveal Image
                        setTimeout(() => img.style.opacity = '1', 100);
                        
                        // Reveal Prompt Container (Below)
                        promptContainer.classList.remove('hidden');
                        // Small delay to allow display:block to apply before opacity transition
                        setTimeout(() => {
                            promptContainer.classList.remove('opacity-0', 'translate-y-4');
                            promptContainer.classList.add('opacity-100', 'translate-y-0');
                        }, 200);

                        resetBtn();
                    };
                } else {
                    alert('The muse is silent: ' + result.error);
                    resetBtn();
                }
            } catch (error) {
                console.error(error);
                alert('Connection to the ethereal realm failed.');
                resetBtn();
            }

            function resetBtn() {
                btn.disabled = false;
                btn.querySelector('span').innerHTML = '<i class="bi bi-arrow-repeat"></i> REINVENT';
            }
        }
    </script>
}
