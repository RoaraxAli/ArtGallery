@model IEnumerable<Project.Models.Feedback>
@{
    ViewData["Title"] = "User Feedback";
    Layout = "_AdminLayout";
}

<div class="mb-8">
    <h1 class="text-3xl font-bold">User Feedback</h1>
    <p class="text-slate-500">Manage inquiries and support messages.</p>
</div>

<div class="grid grid-cols-1 gap-6">
    @foreach (var feedback in Model)
    {
        <div class="bg-[var(--bg-card)] p-6 rounded-2xl shadow-sm border border-[var(--glass-border)]">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h3 class="font-bold text-lg text-[var(--text-primary)]">@feedback.Subject</h3>
                    <p class="text-sm text-[var(--text-secondary)]">From: <span class="text-[var(--text-primary)] font-medium">@feedback.FullName</span> (@feedback.Email)</p>
                    <p class="text-xs text-slate-500">@feedback.SubmittedAt.ToString("MMM dd, yyyy HH:mm")</p>
                </div>
                <div>
                    @if (feedback.IsReplied)
                    {
                        <span class="bg-green-500/10 text-green-400 px-3 py-1 rounded-full text-xs font-bold uppercase border border-green-500/20">Replied</span>
                    }
                    else
                    {
                        <span class="bg-amber-500/10 text-amber-500 px-3 py-1 rounded-full text-xs font-bold uppercase border border-amber-500/20">Pending</span>
                    }
                </div>
            </div>

            <div class="bg-[var(--bg-surface-1)] p-4 rounded-xl mb-4 text-[var(--text-secondary)] text-sm italic border border-[var(--glass-border)]">
                "@feedback.Message"
            </div>

            @if (feedback.IsReplied)
            {
                <div class="border-t border-[var(--glass-border)] pt-4">
                    <p class="text-xs font-bold text-slate-500 uppercase mb-2">Admin Reply (@feedback.RepliedAt?.ToString("MMM dd, yyyy HH:mm"))</p>
                    <div class="text-sm text-[var(--text-secondary)]">
                        @feedback.AdminReply
                    </div>
                </div>
            }
            else
            {
                <div class="border-t border-[var(--glass-border)] pt-4">
                    <button onclick="document.getElementById('reply-form-@feedback.Id').classList.toggle('hidden')" class="btn-premium py-2 px-4 text-xs rounded-lg">
                        Reply to User
                    </button>
                    
                    <div id="reply-form-@feedback.Id" class="hidden mt-4">
                        <form asp-action="ReplyFeedback" method="post">
                            <input type="hidden" name="id" value="@feedback.Id" />
                            <div class="mb-4">
                                <label class="text-xs font-bold uppercase text-slate-500 block mb-2">Your Message</label>
                                <textarea name="reply" rows="4" required class="w-full bg-[var(--bg-surface-1)] border border-[var(--glass-border)] rounded-xl p-3 text-sm text-[var(--text-primary)] outline-none focus:border-primary" placeholder="Write your reply here..."></textarea>
                            </div>
                            <div class="flex gap-2">
                                <button type="submit" class="btn-premium px-6 py-2 rounded-lg">Send Reply</button>
                                <button type="button" onclick="document.getElementById('reply-form-@feedback.Id').classList.add('hidden')" class="text-slate-500 hover:text-[var(--text-primary)] text-sm">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            }
        </div>
    }

    @if (!Model.Any())
    {
        <div class="text-center py-20 bg-[var(--bg-card)] rounded-3xl border-2 border-dashed border-[var(--glass-border)]">
            <i class="bi bi-chat-left-text text-5xl text-slate-700 mb-4 block"></i>
            <p class="text-slate-500">No feedback messages found.</p>
        </div>
    }
</div>
