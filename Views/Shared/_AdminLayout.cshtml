<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Admin</title>
    
    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        primary: 'var(--primary-color)',
                        secondary: 'var(--secondary-color)',
                        dark: 'var(--bg-primary)',
                        glass: 'var(--glass-bg)',
                        'glass-border': 'var(--glass-border)',
                        'bg-surface-1': 'var(--bg-surface-1)',
                        'bg-surface-2': 'var(--bg-surface-2)',
                        'text-primary': 'var(--text-primary)',
                        'text-secondary': 'var(--text-secondary)'
                    },
                    boxShadow: {
                        'glow': '0 0 20px rgba(var(--primary-rgb), 0.3)'
                    }
                }
            }
        }
    </script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="~/css/premium.css" asp-append-version="true" />
    
    <style>
        /* Admin Specific Overrides */
        :root {
            /* Default to a sleek dark theme if session var fails */
            --bg-primary: #0f172a;
            --bg-surface-1: #1e293b;
            --bg-surface-2: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --primary-color: #6366f1;
            --glass-bg: rgba(15, 23, 42, 0.7);
            --glass-border: rgba(255, 255, 255, 0.08);
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
        }

        .admin-sidebar-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 12px;
            color: var(--text-secondary);
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            margin-bottom: 4px;
        }

        .admin-sidebar-link:hover, .admin-sidebar-link.active {
            background: linear-gradient(90deg, rgba(99, 102, 241, 0.1) 0%, transparent 100%);
            color: var(--text-primary);
            border-left: 3px solid var(--primary-color);
        }

        .admin-sidebar-link i {
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .admin-sidebar-link.active i {
            color: var(--primary-color);
            transform: scale(1.1);
        }
    </style>
</head>
@{
    // Theme Logic Reuse
    var currentTheme = Context.Session.GetString("Theme") ?? "dark";
    var themeClass = currentTheme.StartsWith("custom|") ? "theme-custom" : "theme-" + currentTheme;
    // (Simplifying for admin: assuming variables are largely handled by CSS file or defaults, 
    // but reusing the snippet if needed for exact match would be ideal. For now using defaults or what's in premium.css)
}
<body class="@themeClass flex h-screen overflow-hidden bg-[var(--bg-primary)]">

    <!-- Sidebar -->
    <aside class="w-64 flex-shrink-0 bg-[var(--bg-surface-1)] border-r border-[var(--glass-border)] flex flex-col transition-all duration-300 transform -translate-x-full md:translate-x-0 fixed md:relative z-50 h-full" id="adminSidebar">
        <!-- Logo -->
        <div class="h-20 flex items-center px-8 border-b border-[var(--glass-border)]">
            <a href="/Admin/Index" class="flex items-center gap-2 hover:scale-105 transition-transform group">
                <i class="bi bi-layers-half text-primary text-2xl"></i>
                <span class="text-xl font-black tracking-tighter text-[var(--text-primary)]">GALLERY</span>
            </a>
        </div>

        <!-- Check Auth Role strictly -->
        @if (Context.Session.GetString("Role") != "Admin")
        {
            <script>window.location.href = '/Auth/Login';</script>
        }

        <!-- Nav -->
        <nav class="flex-1 overflow-y-auto py-6 px-4 space-y-1">
            <p class="px-4 text-[10px] font-bold text-[var(--text-secondary)] uppercase tracking-widest mb-2">Overview</p>
            
            <a href="/Admin/Index" class="admin-sidebar-link @(ViewContext.RouteData.Values["Action"]?.ToString() == "Index" ? "active" : "")">
                <i class="bi bi-grid-1x2-fill"></i> Dashboard
            </a>
            
            <p class="px-4 text-[10px] font-bold text-[var(--text-secondary)] uppercase tracking-widest mt-8 mb-2">Management</p>
            
            <a href="/Admin/Users" class="admin-sidebar-link @(ViewContext.RouteData.Values["Action"]?.ToString() == "Users" ? "active" : "")">
                <i class="bi bi-people-fill"></i> Users & Roles
            </a>
            <a href="/Admin/Products" class="admin-sidebar-link @(ViewContext.RouteData.Values["Action"]?.ToString() == "Products" ? "active" : "")">
                <i class="bi bi-collection-fill"></i> Artworks
            </a>
            <a href="/Admin/Orders" class="admin-sidebar-link @(ViewContext.RouteData.Values["Action"]?.ToString() == "Orders" ? "active" : "")">
                <i class="bi bi-bag-check-fill"></i> Orders
            </a>
            <a href="/Admin/Exhibitions" class="admin-sidebar-link @(ViewContext.RouteData.Values["Action"]?.ToString() == "Exhibitions" ? "active" : "")">
                <i class="bi bi-calendar-event-fill"></i> Exhibitions
            </a>

            <p class="px-4 text-[10px] font-bold text-[var(--text-secondary)] uppercase tracking-widest mt-8 mb-2">Insights</p>

            <a href="/Admin/Approvals" class="admin-sidebar-link @(ViewContext.RouteData.Values["Action"]?.ToString() == "Approvals" ? "active" : "") group flex justify-between">
                <div class="flex items-center gap-3"><i class="bi bi-check-circle-fill"></i> Approvals</div>
                @if ((ViewBag.PendingApprovals ?? 0) > 0)
                {
                    <span class="bg-amber-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-lg shadow-amber-500/20 animate-pulse">@ViewBag.PendingApprovals</span>
                }
            </a>
            <a href="/Admin/Feedbacks" class="admin-sidebar-link @(ViewContext.RouteData.Values["Action"]?.ToString() == "Feedbacks" ? "active" : "")">
                <i class="bi bi-chat-quote-fill"></i> Feedback
            </a>
        </nav>

        <!-- Footer -->
        <div class="p-4 border-t border-[var(--glass-border)] bg-[var(--bg-surface-1)]">
            <div class="flex items-center gap-3 px-4 py-2">
                <div class="w-8 h-8 rounded-full bg-[var(--primary-color)] flex items-center justify-center text-white font-bold text-xs">
                    AD
                </div>
                <div class="flex-1 overflow-hidden">
                    <p class="text-sm font-bold text-[var(--text-primary)] truncate">@Context.Session.GetString("Name")</p>
                    <p class="text-xs text-[var(--text-secondary)]">Super Admin</p>
                </div>
                <a href="/Auth/Logout" class="text-red-400 hover:text-red-300 transition-colors" title="Logout">
                    <i class="bi bi-box-arrow-right"></i>
                </a>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col h-full relative overflow-hidden">
        
        <!-- Topbar -->
        <header class="h-20 bg-[var(--bg-primary)]/80 backdrop-blur-md border-b border-[var(--glass-border)] flex items-center justify-between px-8 z-40 sticky top-0">
            <div class="flex items-center gap-4">
                <button onclick="document.getElementById('adminSidebar').classList.toggle('-translate-x-full'); document.getElementById('mobilityOverlay').classList.toggle('hidden');" class="md:hidden text-[var(--text-secondary)] text-2xl">
                    <i class="bi bi-list"></i>
                </button>
                <h2 class="text-xl font-bold text-[var(--text-primary)] opacity-80">
                    @(ViewData["Title"] ?? "Admin Dashboard")
                </h2>
            </div>
            
            <div class="flex items-center gap-6">
                 <a href="/" target="_blank" class="hidden md:flex items-center gap-2 text-sm font-medium text-[var(--text-secondary)] hover:text-[var(--primary-color)] transition-colors border border-[var(--glass-border)] px-4 py-2 rounded-full">
                    <i class="bi bi-globe"></i> View Live Site
                </a>
                
                <div class="relative group">
                    <button class="text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-colors relative">
                        <i class="bi bi-bell text-xl"></i>
                        @if ((ViewBag.PendingApprovals ?? 0) > 0)
                        {
                            <span class="absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-[var(--bg-primary)]"></span>
                        }
                    </button>
                </div>
            </div>
        </header>

        <!-- Content Srcollable -->
        <main class="flex-1 overflow-y-auto p-4 md:p-8 relative">
            
            <!-- Alerts -->
            @if (TempData["Success"] != null)
            {
                <div class="mb-6 p-4 rounded-xl bg-green-500/10 border border-green-500/20 text-green-400 flex items-center gap-3 animate-slide-down">
                    <i class="bi bi-check-circle-fill text-xl"></i>
                    <span class="font-medium">@TempData["Success"]</span>
                </div>
            }

            @RenderBody()
            
            <div class="mt-12 text-center text-[var(--text-secondary)] text-sm py-4 border-t border-[var(--glass-border)]">
                &copy; 2025 Art Gallery Admin System.
            </div>
        </main>
        
        <!-- Mobile Overlay -->
        <div id="mobilityOverlay" onclick="document.getElementById('adminSidebar').classList.add('-translate-x-full'); this.classList.add('hidden');" class="fixed inset-0 bg-black/50 z-40 hidden md:hidden glass"></div>
    </div>
    
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
